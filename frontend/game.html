<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Flappy Cinnamoroll</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #gameContainer {
            background-color: #87ceeb; /* Sky blue background */
            border: 3px solid #6a5acd; /* Slate Blue border */
            border-radius: 15px;
            padding: 10px;
            user-select: none;
            -webkit-user-select: none;
            position: relative; 
        }
        #instructions {
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        #result {
            display: none; 
            position: absolute; 
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 10;
            width: 80%;
            max-width: 300px;
            text-align: center;
            color: #333;
        }
        #resultTitle {
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        #resultMessage {
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        #nextButton {
            background-color: #87ceeb;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        #nextButton:hover {
            background-color: #6a5acd;
        }
        
        #initialMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            text-align: center;
            color: #333;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #initialMessage h2 {
            font-size: 2em;
            color: #ffb6c1; /* Pink Cinnamoroll */
            margin-bottom: 10px;
        }
        #initialMessage p {
            font-size: 1.2em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Game Pertama: Flappy Cinnamoroll!</h1>
    <p id="instructions">Dapatkan skor 5 untuk lanjut ke game berikutnya!</p>
    
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="initialMessage">
            <h2>Flappy Cinnamoroll</h2>
            <p>Klik/Sentuh Layar atau Tekan Spasi untuk Mulai Terbang!</p>
        </div>

        <div id="result">
            <h2 id="resultTitle"></h2>
            <p id="resultMessage"></p>
            <button id="nextButton"></button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const initialMessage = document.getElementById('initialMessage');
    const resultDiv = document.getElementById('result');

    const playerImg = new Image();
    playerImg.src = 'cinnamoroll_player.png'; 
    
    const backgroundImg = new Image();
    backgroundImg.src = 'flappy_background.png';

    const canvasWidth = 800;
    const canvasHeight = 480;
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;

    let player, pipes, score, gameOver, gameStarted;
    const gravity = 0.25;
    const jumpStrength = -5;
    const pipeSpeed = 2.5; // Sedikit lebih cepat agar lebih menantang
    const pipeGap = 150;
    const pipeWidth = 60;
    
    // Tema Warna Cinnamoroll
    const pipeColor = '#ffb6c1'; // Pink pastel
    const pipeOutlineColor = '#87ceeb'; // Biru langit

    const MINIMUM_SCORE_TO_WIN = 5;

    function initializeGame() {
        player = {
            x: 50,
            y: canvasHeight / 2 - 20,
            width: 40,
            height: 40,
            velocityY: 0
        };
        pipes = [];
        score = 0;
        gameOver = false;
        gameStarted = false;

        initialMessage.style.display = 'block';
        resultDiv.style.display = 'none';
        draw();
    }

    function generatePipe() {
        const pipeHeight = Math.floor(Math.random() * (canvasHeight - pipeGap - 120)) + 60; // Pipa tidak terlalu pendek/panjang
        pipes.push({
            x: canvasWidth,
            y: 0,
            width: pipeWidth,
            height: pipeHeight,
            passed: false,
            isTop: true
        });
        pipes.push({
            x: canvasWidth,
            y: pipeHeight + pipeGap,
            width: pipeWidth,
            height: canvasHeight - pipeHeight - pipeGap,
            isBottom: true
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        
        if (backgroundImg.complete && backgroundImg.naturalHeight !== 0) {
            ctx.drawImage(backgroundImg, 0, 0, canvasWidth, canvasHeight);
        } else {
            ctx.fillStyle = '#87ceeb'; 
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
        }

        if (playerImg.complete) {
            ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
        }

        pipes.forEach(pipe => {
            ctx.fillStyle = pipeColor;
            ctx.fillRect(pipe.x, pipe.y, pipe.width, pipe.height);
            ctx.strokeStyle = pipeOutlineColor;
            ctx.lineWidth = 4; // Outline lebih tebal
            ctx.strokeRect(pipe.x, pipe.y, pipe.width, pipe.height);
        });

        ctx.fillStyle = 'white';
        ctx.font = '30px Arial';
        ctx.strokeStyle = '#6a5acd';
        ctx.lineWidth = 3;
        ctx.strokeText(`Skor: ${score}`, 10, 40);
        ctx.fillText(`Skor: ${score}`, 10, 40);
    }

    function update() {
        if (gameOver || !gameStarted) return;

        player.velocityY += gravity;
        player.y += player.velocityY;

        if (player.y + player.height > canvasHeight || player.y < 0) {
            endGame();
            return;
        }

        if (pipes.length === 0 || pipes[pipes.length - 1].x < canvasWidth - 250) {
            generatePipe();
        }

        pipes.forEach(pipe => {
            pipe.x -= pipeSpeed;

            if (player.x < pipe.x + pipe.width &&
                player.x + player.width > pipe.x &&
                player.y < pipe.y + pipe.height &&
                player.y + player.height > pipe.y) {
                endGame();
                return;
            }

            if (!pipe.passed && pipe.isTop && pipe.x + pipe.width < player.x) {
                pipe.passed = true;
                score++;
            }
        });

        pipes = pipes.filter(pipe => pipe.x + pipe.width > 0);

        draw();
        requestAnimationFrame(update);
    }

    function playerJump() {
        if (!gameOver) {
            if (!gameStarted) {
                gameStarted = true;
                initialMessage.style.display = 'none';
                update();
            }
            player.velocityY = jumpStrength;
        }
    }

    function endGame() {
        gameOver = true;
        gameStarted = false;
        resultDiv.style.display = 'block';

        const resultTitle = document.getElementById('resultTitle');
        const resultMessage = document.getElementById('resultMessage');
        const nextButton = document.getElementById('nextButton');

        if (score >= MINIMUM_SCORE_TO_WIN) {
            resultTitle.textContent = "U Win! âœ¨";
            resultTitle.style.color = '#87ceeb';
            resultMessage.textContent = `Skor kamu: ${score}. Hebat!`;
            nextButton.textContent = "Next game hehe";
            nextButton.onclick = () => {
                window.location.href = 'pacman.html';
            };
        } else {
            resultTitle.textContent = "Game Over! ðŸ’”";
            resultTitle.style.color = '#ffb6c1';
            resultMessage.textContent = `Skor kak cia ${score}. try again minimal 5!`;
            nextButton.textContent = "Try Again";
            nextButton.onclick = () => {
                window.location.reload();
            };
        }
    }

    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            playerJump();
        }
    });
    canvas.addEventListener('click', playerJump);

    let loadedImages = 0;
    const imagesToLoad = [playerImg, backgroundImg];
    imagesToLoad.forEach(img => {
        img.onload = () => {
            loadedImages++;
            if (loadedImages === imagesToLoad.length) {
                initializeGame();
            }
        };
        img.onerror = () => {
            console.error(`Gagal memuat gambar: ${img.src}.`);
            loadedImages++; 
            if (loadedImages === imagesToLoad.length) {
                initializeGame();
            }
        };
    });

</script>

</body>
</html>