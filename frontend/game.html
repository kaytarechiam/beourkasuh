<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Flappy Cinnamoroll</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="gameContainer" class="container">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="gameOverScreen" class="container">
        <h2>Game Over!</h2>
        <p>Skor kamu: <span id="finalScore">0</span></p>
        <p id="gameMessage"></p>
        <button id="lanjutButton" onclick="lanjutKePertanyaan()" style="display: none;">Lanjut</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- ASET & PENGATURAN ---
    const cinnamorollImg = new Image();
    cinnamorollImg.src = 'cinnamoroll_player.png'; // Pastikan nama file ini benar

    let player = {
        x: 70, y: 250, width: 60, height: 50,
        velocityY: 0, gravity: 0.4, lift: -8
    };

    const pipes = [];
    let score = 0;
    const requiredScore = 5;
    let frameCount = 0;
    
    // --- STATUS GAME ---
    let gameStarted = false;
    let gameOver = false;
    let gameWon = false;

    // --- FUNGSI KONTROL ---
    function jump() {
        // Jika game belum mulai, kita mulai game-nya
        if (!gameStarted) {
            gameStarted = true;
        }
        // Jika game sudah berjalan, buat Cinnamoroll melompat
        if (!gameOver) {
            player.velocityY = player.lift;
        }
    }

    // --- EVENT LISTENER (CARA MAIN) ---
    // Sekarang bisa pakai klik, sentuh, atau spasi
    window.addEventListener('mousedown', jump);
    window.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Mencegah zoom/scroll di mobile
        jump();
    });
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            jump();
        }
    });

    // --- FUNGSI TAMPILAN GAME OVER & LANJUT ---
    function showGameOver() {
        gameOver = true;
        const gameOverScreen = document.getElementById('gameOverScreen');
        document.getElementById('finalScore').textContent = score;
        const gameMessage = document.getElementById('gameMessage');
        const lanjutButton = document.getElementById('lanjutButton');

        if (score >= requiredScore) {
            gameWon = true;
            gameMessage.innerHTML = `Hore! Kamu berhasil dapat skor ${score}! <br> Yuk lanjut...`;
            lanjutButton.style.display = 'block';
        } else {
            gameMessage.innerHTML = `Skor kamu baru ${score}. Coba lagi ya, kamu perlu skor ${requiredScore} untuk lanjut!`;
            lanjutButton.style.display = 'none';
            if (!document.getElementById('restartButton')) {
                const restartButton = document.createElement('button');
                restartButton.textContent = 'Main Lagi';
                restartButton.id = 'restartButton';
                restartButton.onclick = () => window.location.reload();
                gameOverScreen.appendChild(restartButton);
            }
        }
        gameOverScreen.style.display = 'block';
    }

    function lanjutKePertanyaan() {
        if (gameWon) {
            window.location.href = 'ask_cia.html';
        }
    }

    // --- LOOP UTAMA GAME ---
    function draw() {
        // Gambar latar belakang
        ctx.fillStyle = '#f0f8ff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Jika game belum dimulai, tampilkan instruksi
        if (!gameStarted) {
            ctx.fillStyle = '#ff69b4';
            ctx.font = 'bold 28px "Plus Jakarta Sans"';
            ctx.textAlign = 'center';
            ctx.fillText('Flappy Cinnamoroll', canvas.width / 2, canvas.height / 2 - 60);
            ctx.font = '20px "Plus Jakarta Sans"';
            ctx.fillStyle = '#555';
            ctx.fillText('Klik/Sentuh Layar atau Tekan Spasi', canvas.width / 2, canvas.height / 2);
            ctx.fillText('untuk Mulai Terbang!', canvas.width / 2, canvas.height / 2 + 30);
            ctx.textAlign = 'start';
        } else {
            // --- Logika Game Berjalan ---

            // Perbarui & gambar pipa
            if (frameCount % 100 === 0) {
                const topPipeHeight = Math.random() * (canvas.height - 200 - 150) + 75;
                pipes.push({ x: canvas.width, topHeight: topPipeHeight, bottomY: topPipeHeight + 200, passed: false });
            }
            for (let i = pipes.length - 1; i >= 0; i--) {
                const p = pipes[i];
                p.x -= 3;
                ctx.fillStyle = '#87ceeb';
                ctx.fillRect(p.x, 0, 60, p.topHeight);
                ctx.fillRect(p.x, p.bottomY, 60, canvas.height - p.bottomY);
                if (p.x + 60 < 0) pipes.splice(i, 1);
                if (p.x + 60 < player.x && !p.passed) { p.passed = true; score++; }
                if (player.x < p.x + 60 && player.x + player.width > p.x && (player.y < p.topHeight || player.y + player.height > p.bottomY)) { showGameOver(); return; }
            }

            // Perbarui & gambar pemain
            player.velocityY += player.gravity;
            player.y += player.velocityY;
            if (player.y + player.height > canvas.height || player.y < 0) { showGameOver(); return; }
            
            // Tampilkan skor
            ctx.fillStyle = '#ff69b4';
            ctx.font = 'bold 30px "Plus Jakarta Sans"';
            ctx.fillText('Skor: ' + score, 15, 40);
            ctx.font = 'bold 20px "Plus Jakarta Sans"';
            ctx.fillText('Target: ' + requiredScore, 15, 70);
        }
        
        // Selalu gambar Cinnamoroll
        ctx.drawImage(cinnamorollImg, player.x, player.y, player.width, player.height);

        // Lanjutkan ke frame berikutnya
        if (!gameOver) {
            frameCount++;
            requestAnimationFrame(draw);
        }
    }
    
    // Mulai loop gambar saat gambar selesai dimuat
    cinnamorollImg.onload = draw;
    cinnamorollImg.onerror = () => {
        alert("Gagal memuat gambar cinnamoroll_player.png. Pastikan filenya ada di folder frontend ya!");
        draw(); // Tetap jalankan game walau tanpa gambar
    }
</script>

</body>
</html>