<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cinnamoroll Man</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Style khusus untuk Pac-Man agar rapi */
        #gameContainerPacman {
            background-color: #000;
            border-radius: 15px;
            padding: 10px;
            /* Mencegah highlight teks saat menekan tombol panah */
            user-select: none; 
            -webkit-user-select: none;
        }
        #pacmanInstructions {
            color: white;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        #pacmanResult {
            display: none; 
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Game Kedua: Cinnamoroll-Man!</h1>
    <p>Gunakan tombol panah atau W/A/S/D untuk bergerak.</p>
    <p id="pacmanInstructions">Hayoo dikejarr desuuuuh</p>
    <div id="gameContainerPacman">
        <canvas id="pacmanCanvas"></canvas>
    </div>
    <div id="pacmanResult">
        <h2 id="resultTitle"></h2>
        <p id="resultMessage"></p>
        <button id="nextButton">Lanjut ke Game Berikutnya</button>
    </div>
</div>


<script>
    const canvas = document.getElementById('pacmanCanvas');
    const ctx = canvas.getContext('2d');

    const tileSize = 32;
    canvas.width = 15 * tileSize;
    canvas.height = 16 * tileSize; // Disesuaikan agar pas dengan peta

    // --- ASET GAMBAR (GANTI DI SINI) ---
    const playerImg = new Image();
    playerImg.src = 'cinnamoroll_player.png'; // Ganti dengan gambar Cinnamoroll

    const ghost1Img = new Image();
    ghost1Img.src = 'ciw_ghost.png'; // Ganti dengan gambar Ciw sebagai hantu

    const ghost2Img = new Image();
    ghost2Img.src = 'kei_ghost.png'; // Ganti dengan gambar Kei sebagai hantu

    // --- PETA GAME ---
    const map = [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,3,1,2,1,1,2,1,2,1,1,2,1,3,1],
        [1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
        [1,2,1,1,2,1,1,1,1,1,2,1,1,2,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,1,1,2,1,1,0,0,0,1,1,2,1,1,1],
        [0,0,1,2,1,0,0,0,0,0,1,2,1,0,0],
        [1,1,1,2,1,0,0,0,0,0,1,2,1,1,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,3,1,2,1,1,2,1,2,1,1,2,1,3,1],
        [1,2,2,2,1,1,2,2,2,1,1,2,2,2,1],
        [1,2,1,2,2,2,2,1,2,2,2,2,1,2,1],
        [1,2,1,1,1,1,2,1,2,1,1,1,1,2,1],
        [1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    ];

    let player = { x: 7 * tileSize, y: 13 * tileSize, dx: 0, dy: 0, speed: 2, nextDx: 0, nextDy: 0 };
    let ghosts = [];
    let score = 0;
    let totalCoins = map.reduce((sum, row) => sum + row.filter(tile => tile === 2).length, 0);
    let gameOver = false;

    function resetGame() {
        player = { x: 7 * tileSize, y: 13 * tileSize, dx: 0, dy: 0, speed: 2, nextDx: 0, nextDy: 0 };
        ghosts = [
            { x: 6 * tileSize, y: 7 * tileSize, dx: 0, dy: -2, speed: 2, img: ghost1Img },
            { x: 8 * tileSize, y: 7 * tileSize, dx: 0, dy: -2, speed: 2, img: ghost2Img }
        ];
    }
    
    // --- KONTROL PEMAIN (BAGIAN PENTING) ---
    window.addEventListener('keydown', (e) => {
        e.preventDefault();
        switch(e.key) {
            case 'ArrowUp': case 'w': player.nextDx = 0; player.nextDy = -player.speed; break;
            case 'ArrowDown': case 's': player.nextDx = 0; player.nextDy = player.speed; break;
            case 'ArrowLeft': case 'a': player.nextDx = -player.speed; player.nextDy = 0; break;
            case 'ArrowRight': case 'd': player.nextDx = player.speed; player.dy = 0; break;
        }
    });

    function isWall(x, y) {
        const col = Math.floor(x / tileSize);
        const row = Math.floor(y / tileSize);
        return map[row] && (map[row][col] === 1);
    }
    
    function showResult(isWin) {
        gameOver = true;
        document.getElementById('gameContainerPacman').style.display = 'none';
        document.getElementById('pacmanResult').style.display = 'block';
        
        const title = document.getElementById('resultTitle');
        const message = document.getElementById('resultMessage');
        const nextButton = document.getElementById('nextButton');

        if (isWin) {
            title.textContent = "Kamu Menang!";
            message.textContent = `Hebat, kamu berhasil! Skor akhir: ${score}`;
            nextButton.textContent = "Lanjut ke Game Ular";
            nextButton.onclick = () => { window.location.href = 'snake.html'; }; // Diarahkan ke game ular
        } else {
            title.textContent = "Kamu Tertangkap!";
            message.textContent = "Jangan menyerah, coba lagi ya!";
            nextButton.textContent = "Main Lagi";
            nextButton.onclick = () => window.location.reload();
        }
    }

    function gameLoop() {
        if (gameOver) return;

        // Gerakan Pemain yang lebih baik
        let nextPlayerX = player.x + player.nextDx;
        let nextPlayerY = player.y + player.nextDy;
        if (!isWall(nextPlayerX, nextPlayerY) && !isWall(nextPlayerX + tileSize - 1, nextPlayerY + tileSize - 1)) {
            player.dx = player.nextDx;
            player.dy = player.nextDy;
        }
        
        let currentX = player.x + player.dx;
        let currentY = player.y + player.dy;
        if (!isWall(currentX, currentY) && !isWall(currentX + tileSize - 1, currentY + tileSize - 1)) {
            player.x = currentX;
            player.y = currentY;
        }

        // Terowongan
        if (player.x < -tileSize) player.x = canvas.width;
        if (player.x > canvas.width) player.x = -tileSize;
        
        // Koin
        const playerCol = Math.floor((player.x + tileSize/2) / tileSize);
        const playerRow = Math.floor((player.y + tileSize/2) / tileSize);
        if (map[playerRow] && map[playerRow][playerCol] === 2) {
            map[playerRow][playerCol] = 0;
            score++;
            if (score === totalCoins) {
                showResult(true);
                return;
            }
        }
        
        // Gerakan Hantu
        ghosts.forEach(ghost => {
            ghost.x += ghost.dx;
            ghost.y += ghost.dy;
            if (isWall(ghost.x, ghost.y) || isWall(ghost.x + tileSize -1, ghost.y + tileSize -1) || Math.random() < 0.05) {
                const directions = [{dx: ghost.speed, dy: 0}, {dx: -ghost.speed, dy: 0}, {dx: 0, dy: ghost.speed}, {dx: 0, dy: -ghost.speed}];
                const newDir = directions[Math.floor(Math.random() * directions.length)];
                ghost.dx = newDir.dx;
                ghost.dy = newDir.dy;
            }
            if (Math.hypot(player.x - ghost.x, player.y - ghost.y) < tileSize-5) {
                showResult(false);
                return;
            }
        });

        // Gambar Semuanya
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let row = 0; row < map.length; row++) {
            for (let col = 0; col < map[row].length; col++) {
                if (map[row][col] === 1) {
                    ctx.fillStyle = '#1e90ff'; // Dinding
                    ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
                } else if (map[row][col] === 2) {
                    ctx.fillStyle = '#ffd700'; // Koin
                    ctx.beginPath();
                    ctx.arc(col * tileSize + tileSize / 2, row * tileSize + tileSize / 2, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }
        ctx.drawImage(playerImg, player.x, player.y, tileSize, tileSize);
        ghosts.forEach(ghost => ctx.drawImage(ghost.img, ghost.x, ghost.y, tileSize, tileSize));

        requestAnimationFrame(gameLoop);
    }
    
    let imagesLoaded = 0;
    const totalImages = 3;
    [playerImg, ghost1Img, ghost2Img].forEach(img => {
        img.onload = () => {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                resetGame();
                gameLoop();
            }
        }
        img.onerror = () => {
             alert(`Gambar ${img.src.split('/').pop()} tidak ditemukan. Pastikan ada di folder frontend ya!`);
        }
    });

</script>

</body>
</html>