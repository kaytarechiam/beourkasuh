<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cinnamoroll Man</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #gameContainerPacman {
            background-color: #000;
            border-radius: 15px;
            padding: 10px;
        }
        #pacmanInstructions {
            color: white;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Game Kedua: Cinnamoroll-Man!</h1>
    <p id="pacmanInstructions">Hayoo dikejarr desuuuuh</p>
    <div id="gameContainerPacman">
        <canvas id="pacmanCanvas"></canvas>
    </div>
    <div id="pacmanResult" style="display: none; margin-top: 20px;">
        <h2 id="resultTitle"></h2>
        <p id="resultMessage"></p>
        <button id="nextButton">Lanjut ke Game Terakhir</button>
    </div>
</div>


<script>
    const canvas = document.getElementById('pacmanCanvas');
    const ctx = canvas.getContext('2d');

    const tileSize = 32; // Ukuran setiap kotak di grid
    canvas.width = 15 * tileSize; // Lebar canvas
    canvas.height = 17 * tileSize; // Tinggi canvas

    // --- ASET GAMBAR (GANTI DI SINI) ---
    const playerImg = new Image();
    playerImg.src = 'cinnamoroll_player.png'; // Ganti dengan gambar Cinnamoroll untuk Pac-Man

    const ghost1Img = new Image();
    ghost1Img.src = 'ciw_ghost.png'; // Ganti dengan gambar Ciw sebagai hantu

    const ghost2Img = new Image();
    ghost2Img.src = 'kei_ghost.png'; // Ganti dengan gambar Kei sebagai hantu

    // --- PETA GAME ---
    // 0 = kosong, 1 = dinding, 2 = koin, 3 = power-up
    const map = [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,3,1,2,1,1,2,1,2,1,1,2,1,3,1],
        [1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
        [1,2,1,1,2,1,1,1,1,1,2,1,1,2,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,1,1,2,1,1,0,0,0,1,1,2,1,1,1],
        [0,0,1,2,1,0,0,0,0,0,1,2,1,0,0],
        [1,1,1,2,1,1,1,1,1,1,1,2,1,1,1],
        [1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],
        [1,3,1,2,1,1,2,1,2,1,1,2,1,3,1],
        [1,2,2,2,1,1,2,2,2,1,1,2,2,2,1],
        [1,2,1,2,2,2,2,1,2,2,2,2,1,2,1],
        [1,2,1,1,1,1,2,1,2,1,1,1,1,2,1],
        [1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    ];

    let player = { x: 7 * tileSize, y: 12 * tileSize, dx: 0, dy: 0, speed: 2 };
    let ghosts = [
        { x: 6 * tileSize, y: 7 * tileSize, dx: 0, dy: -2, speed: 2, img: ghost1Img },
        { x: 8 * tileSize, y: 7 * tileSize, dx: 0, dy: -2, speed: 2, img: ghost2Img }
    ];

    let score = 0;
    let totalCoins = 0;
    map.forEach(row => row.forEach(tile => { if (tile === 2) totalCoins++; }));

    // --- KONTROL PEMAIN ---
    window.addEventListener('keydown', (e) => {
        switch(e.key) {
            case 'ArrowUp': case 'w': player.dx = 0; player.dy = -player.speed; break;
            case 'ArrowDown': case 's': player.dx = 0; player.dy = player.speed; break;
            case 'ArrowLeft': case 'a': player.dx = -player.speed; player.dy = 0; break;
            case 'ArrowRight': case 'd': player.dx = player.speed; player.dy = 0; break;
        }
    });

    function checkCollision(x, y) {
        const col = Math.floor(x / tileSize);
        const row = Math.floor(y / tileSize);
        return map[row] && map[row][col] === 1;
    }

    function showResult(isWin) {
        document.getElementById('gameContainerPacman').style.display = 'none';
        document.getElementById('pacmanResult').style.display = 'block';
        const title = document.getElementById('resultTitle');
        const message = document.getElementById('resultMessage');
        const nextButton = document.getElementById('nextButton');

        if (isWin) {
            title.textContent = "Kamu Menang!";
            message.textContent = "Hebat, kamu berhasil mengumpulkan semua koin!";
        } else {
            title.textContent = "Kamu Tertangkap!";
            message.textContent = "Yah, jangan menyerah, coba lagi ya!";
            nextButton.textContent = "Main Lagi";
        }
        
        nextButton.onclick = () => {
            if (isWin) {
                // Nanti kita arahkan ke game ular
                alert("Game Ular akan ditambahkan di sini!"); 
            } else {
                window.location.reload();
            }
        };
    }

    function gameLoop() {
        // --- GERAKAN PEMAIN ---
        let nextX = player.x + player.dx;
        let nextY = player.y + player.dy;

        if (!checkCollision(nextX, player.y) && !checkCollision(nextX + tileSize -1, player.y) &&
            !checkCollision(nextX, player.y + tileSize -1) && !checkCollision(nextX + tileSize-1, player.y + tileSize -1)) {
            player.x = nextX;
        }
        if (!checkCollision(player.x, nextY) && !checkCollision(player.x + tileSize -1, nextY) &&
            !checkCollision(player.x, nextY + tileSize -1) && !checkCollision(player.x + tileSize-1, nextY + tileSize -1)) {
            player.y = nextY;
        }

        // Terowongan
        if (player.x < -tileSize) player.x = canvas.width;
        if (player.x > canvas.width) player.x = -tileSize;
        
        // --- KOIN ---
        const playerCol = Math.floor(player.x / tileSize);
        const playerRow = Math.floor(player.y / tileSize);
        if (map[playerRow] && map[playerRow][playerCol] === 2) {
            map[playerRow][playerCol] = 0; // Koin dimakan
            score++;
            if (score === totalCoins) {
                showResult(true);
                return;
            }
        }
        
        // --- GERAKAN HANTU (sederhana) ---
        ghosts.forEach(ghost => {
            ghost.x += ghost.dx;
            ghost.y += ghost.dy;

            if (checkCollision(ghost.x, ghost.y) || Math.random() < 0.05) {
                const directions = [{dx: ghost.speed, dy: 0}, {dx: -ghost.speed, dy: 0}, {dx: 0, dy: ghost.speed}, {dx: 0, dy: -ghost.speed}];
                const newDir = directions[Math.floor(Math.random() * directions.length)];
                ghost.dx = newDir.dx;
                ghost.dy = newDir.dy;
            }

            // Cek tabrakan dengan pemain
            if (Math.hypot(player.x - ghost.x, player.y - ghost.y) < tileSize) {
                showResult(false);
                return;
            }
        });


        // --- GAMBAR SEMUANYA ---
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Gambar Peta
        for (let row = 0; row < map.length; row++) {
            for (let col = 0; col < map[row].length; col++) {
                if (map[row][col] === 1) {
                    ctx.fillStyle = '#0000ff'; // Dinding
                    ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
                } else if (map[row][col] === 2) {
                    ctx.fillStyle = '#ffff00'; // Koin
                    ctx.beginPath();
                    ctx.arc(col * tileSize + tileSize / 2, row * tileSize + tileSize / 2, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        // Gambar Pemain
        ctx.drawImage(playerImg, player.x, player.y, tileSize, tileSize);

        // Gambar Hantu
        ghosts.forEach(ghost => {
            ctx.drawImage(ghost.img, ghost.x, ghost.y, tileSize, tileSize);
        });

        requestAnimationFrame(gameLoop);
    }
    
    // Tunggu semua gambar dimuat
    let imagesLoaded = 0;
    const totalImages = 3;
    [playerImg, ghost1Img, ghost2Img].forEach(img => {
        img.onload = () => {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                gameLoop();
            }
        }
    });

</script>

</body>
</html>