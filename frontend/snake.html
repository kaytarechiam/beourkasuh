<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cinnamoroll Snake</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #gameContainerSnake {
            background-color: #f0f8ff; /* Alice Blue - Latar belakang Cinnamoroll */
            border-radius: 15px;
            padding: 10px;
            user-select: none;
            -webkit-user-select: none;
            display: inline-block;
        }
        #snakeResult {
            display: none;
            margin-top: 20px;
        }
        #scoreDisplay {
            font-size: 1.3em;
            font-weight: bold;
            color: #5c5c5c;
            margin-top: 5px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Cinnamoroll-Snake!</h1>
    <p>pake tombol panah atau W/A/S/D untuk bergerak yess.</p>
    <p>4 win need 15 foooodd</p>
    
    <p id="scoreDisplay">Skor: 0</p> 

    <div id="gameContainerSnake">
        <canvas id="snakeCanvas"></canvas>
    </div>
    <div id="snakeResult">
        <h2 id="resultTitleSnake"></h2>
        <p id="resultMessageSnake"></p>
        <button id="actionButtonSnake">next</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('snakeCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('scoreDisplay');

    const tileSize = 20;
    const canvasSize = 20;
    canvas.width = canvas.height = canvasSize * tileSize;

    let snake, food, direction, score, gameOver;
    const MINIMUM_SCORE_TO_WIN = 15;

    function initializeGame() {
        snake = [{ x: 10, y: 10 }];
        food = getRandomFoodPosition();
        direction = { x: 0, y: 0 };
        score = 0;
        gameOver = false;
        
        scoreElement.textContent = `Skor: ${score}`;
        document.getElementById('gameContainerSnake').style.display = 'block';
        document.getElementById('snakeResult').style.display = 'none';

        gameLoop();
    }

    function getRandomFoodPosition() {
        let newFood;
        do {
            newFood = {
                x: Math.floor(Math.random() * canvasSize),
                y: Math.floor(Math.random() * canvasSize)
            };
        } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
        return newFood;
    }

    window.addEventListener('keydown', e => {
        e.preventDefault();
        switch(e.key) {
            case 'ArrowUp': case 'w':
                if (direction.y === 0) direction = { x: 0, y: -1 };
                break;
            case 'ArrowDown': case 's':
                if (direction.y === 0) direction = { x: 0, y: 1 };
                break;
            case 'ArrowLeft': case 'a':
                if (direction.x === 0) direction = { x: -1, y: 0 };
                break;
            case 'ArrowRight': case 'd':
                if (direction.x === 0) direction = { x: 1, y: 0 };
                break;
        }
    });

    function showResult(isWin) {
        gameOver = true;
        document.getElementById('gameContainerSnake').style.display = 'none';
        document.getElementById('snakeResult').style.display = 'block';
        const title = document.getElementById('resultTitleSnake');
        const message = document.getElementById('resultMessageSnake');
        const button = document.getElementById('actionButtonSnake');

        if (isWin) {
            title.textContent = "Congratss!";
            message.textContent = `skor akhir: ${score}`;
            button.textContent = "See messages";
            // DIUBAH DI SINI: Arahkan ke halaman buku
            button.onclick = () => { window.location.href = 'message_book.html'; };
        } else {
            title.textContent = "Game Over yahh!";
            message.textContent = `Kak kok nabrak ekor sendiri sii. Skor: ${score}`;
            button.textContent = "Try Again";
            button.onclick = () => window.location.reload();
        }
    }

    function gameLoop() {
        if (gameOver) return;

        const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

        if (head.x < 0) head.x = canvasSize - 1;
        if (head.x >= canvasSize) head.x = 0;
        if (head.y < 0) head.y = canvasSize - 1;
        if (head.y >= canvasSize) head.y = 0;

        for (let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) {
                showResult(false);
                return;
            }
        }

        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
            score++;
            scoreElement.textContent = `Skor: ${score}`;
            food = getRandomFoodPosition();
            if (score >= MINIMUM_SCORE_TO_WIN) {
                showResult(true);
                return;
            }
        } else {
            snake.pop();
        }

        ctx.fillStyle = '#f0f8ff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < canvasSize; i++) {
            for (let j = 0; j < canvasSize; j++) {
                ctx.strokeStyle = '#e0e8f0';
                ctx.strokeRect(i * tileSize, j * tileSize, tileSize, tileSize);
            }
        }

        snake.forEach(segment => {
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(segment.x * tileSize, segment.y * tileSize, tileSize, tileSize);
            ctx.strokeStyle = '#f0f8ff';
            ctx.strokeRect(segment.x * tileSize, segment.y * tileSize, tileSize, tileSize);
        });

        ctx.fillStyle = '#ffb6c1';
        ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize, tileSize);
        
        setTimeout(gameLoop, 150 - score * 5);
    }

    initializeGame();
</script>

</body>
</html>