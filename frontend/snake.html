<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cinnamoroll Snake</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #gameContainerSnake {
            background-color: #f0f8ff; /* Alice Blue - Latar belakang Cinnamoroll */
            border-radius: 15px;
            padding: 10px;
            user-select: none;
            -webkit-user-select: none;
            display: inline-block;
        }
        #snakeResult {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Game Ketiga: Cinnamoroll-Snake!</h1>
    <p>Gunakan tombol panah atau W/A/S/D untuk bergerak.</p>
    <p>Capai skor 15 untuk menang!</p>
    <div id="gameContainerSnake">
        <canvas id="snakeCanvas"></canvas>
    </div>
    <div id="snakeResult">
        <h2 id="resultTitleSnake"></h2>
        <p id="resultMessageSnake"></p>
        <button id="actionButtonSnake">Lanjut</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('snakeCanvas');
    const ctx = canvas.getContext('2d');

    const tileSize = 20;
    const canvasSize = 20; // 20 tiles x 20 tiles
    canvas.width = canvas.height = canvasSize * tileSize;

    let snake, food, direction, score, gameOver;
    const MINIMUM_SCORE_TO_WIN = 15;

    function initializeGame() {
        snake = [{ x: 10, y: 10 }];
        food = getRandomFoodPosition();
        direction = { x: 0, y: 0 };
        score = 0;
        gameOver = false;
        
        document.getElementById('gameContainerSnake').style.display = 'block';
        document.getElementById('snakeResult').style.display = 'none';

        gameLoop();
    }

    function getRandomFoodPosition() {
        let newFood;
        do {
            newFood = {
                x: Math.floor(Math.random() * canvasSize),
                y: Math.floor(Math.random() * canvasSize)
            };
        } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
        return newFood;
    }

    window.addEventListener('keydown', e => {
        e.preventDefault();
        switch(e.key) {
            case 'ArrowUp': case 'w':
                if (direction.y === 0) direction = { x: 0, y: -1 };
                break;
            case 'ArrowDown': case 's':
                if (direction.y === 0) direction = { x: 0, y: 1 };
                break;
            case 'ArrowLeft': case 'a':
                if (direction.x === 0) direction = { x: -1, y: 0 };
                break;
            case 'ArrowRight': case 'd':
                if (direction.x === 0) direction = { x: 1, y: 0 };
                break;
        }
    });

    function showResult(isWin) {
        gameOver = true;
        document.getElementById('gameContainerSnake').style.display = 'none';
        document.getElementById('snakeResult').style.display = 'block';
        const title = document.getElementById('resultTitleSnake');
        const message = document.getElementById('resultMessageSnake');
        const button = document.getElementById('actionButtonSnake');

        if (isWin) {
            title.textContent = "Kamu Menang!";
            message.textContent = `Hebat, kamu berhasil menyelesaikan semua game! Skor akhir: ${score}`;
            button.textContent = "Lihat Pesan Terakhir";
            button.onclick = () => { window.location.href = 'thankyou.html'; };
        } else {
            title.textContent = "Game Over!";
            message.textContent = `Kamu menabrak dirimu sendiri. Skor: ${score}`;
            button.textContent = "Main Lagi";
            button.onclick = () => window.location.reload();
        }
    }

    function gameLoop() {
        if (gameOver) return;

        // --- Logika Utama Game ---
        const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

        // --- Logika Tembok Tembus (Nokia Style) ---
        if (head.x < 0) head.x = canvasSize - 1;
        if (head.x >= canvasSize) head.x = 0;
        if (head.y < 0) head.y = canvasSize - 1;
        if (head.y >= canvasSize) head.y = 0;

        // Cek tabrakan dengan diri sendiri
        // Mulai dari 1 untuk mengabaikan kepala
        for (let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) {
                showResult(false);
                return;
            }
        }

        snake.unshift(head);

        // Cek makan makanan
        if (head.x === food.x && head.y === food.y) {
            score++;
            food = getRandomFoodPosition();
            // Cek kemenangan
            if (score >= MINIMUM_SCORE_TO_WIN) {
                showResult(true);
                return;
            }
        } else {
            snake.pop();
        }

        // --- Gambar Ulang Semua ---
        // Latar belakang
        ctx.fillStyle = '#f0f8ff'; // Alice Blue
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Gambar grid
        for (let i = 0; i < canvasSize; i++) {
            for (let j = 0; j < canvasSize; j++) {
                ctx.strokeStyle = '#e0e8f0'; // Warna grid lebih lembut
                ctx.strokeRect(i * tileSize, j * tileSize, tileSize, tileSize);
            }
        }

        // Gambar ular
        snake.forEach(segment => {
            ctx.fillStyle = '#87ceeb'; // Sky Blue (Cinnamoroll Blue)
            ctx.fillRect(segment.x * tileSize, segment.y * tileSize, tileSize, tileSize);
            ctx.strokeStyle = '#f0f8ff'; // Alice Blue (outline)
            ctx.strokeRect(segment.x * tileSize, segment.y * tileSize, tileSize, tileSize);
        });

        // Gambar makanan
        ctx.fillStyle = '#ffb6c1'; // Light Pink (Cinnamoroll's cheek color)
        ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize, tileSize);
        
        setTimeout(gameLoop, 150 - score * 5); // Kecepatan bertambah seiring skor
    }

    initializeGame();

</script>

</body>
</html>